<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calibrador PDF - ZARA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { margin: 0; font-family: system-ui; display: flex; height: 100vh; overflow: hidden; background: #f0f0f0; }
        #panel { width: 350px; background: white; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); overflow-y: auto; z-index: 10; }
        #preview-container { flex: 1; height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        iframe { width: 100%; height: 100%; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.2); background: white; }
        h3 { margin-top: 0; color: #4f46e5; }
        .control-group { margin-bottom: 15px; background: #f9fafb; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb; }
        label { display: flex; justify-content: space-between; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #374151; }
        input[type="range"] { width: 100%; }
        select { width: 100%; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
        .code-box { background: #1f2937; color: #10b981; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 11px; white-space: pre-wrap; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="panel">
        <h3>Calibrador Visual</h3>
        
        <div class="control-group">
            <label>Margen Global de la Hoja <span id="val-margin">12</span></label>
            <input type="range" id="margin" min="0" max="30" value="12" oninput="updatePDF()">
        </div>

        <div class="control-group">
            <label>Columna Izq: Etiqueta (X) <span id="val-leftColLabelX">15</span></label>
            <input type="range" id="leftColLabelX" min="0" max="100" value="15" oninput="updatePDF()">
            
            <label>Columna Izq: Valor (X) <span id="val-leftColValueX">45</span></label>
            <input type="range" id="leftColValueX" min="0" max="100" value="45" oninput="updatePDF()">
        </div>

        <div class="control-group">
            <label>Columna Der: Etiqueta (X) <span id="val-rightColLabelX">115</span></label>
            <input type="range" id="rightColLabelX" min="50" max="200" value="115" oninput="updatePDF()">
            
            <label>Columna Der: Valor (X) <span id="val-rightColValueX">150</span></label>
            <input type="range" id="rightColValueX" min="50" max="200" value="150" oninput="updatePDF()">
        </div>

        <div class="control-group">
            <label>Estilo de Tablas</label>
            <select id="tableTheme" onchange="updatePDF()">
                <option value="plain">Sin Bordes Internos (Plain)</option>
                <option value="grid">Bordes de Excel (Grid)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Grosor del Borde Interno <span id="val-lineWidth">0</span></label>
            <input type="range" id="lineWidth" min="0" max="2" step="0.1" value="0" oninput="updatePDF()">
        </div>

        <div class="code-box">
            <b>Copia estos valores a tu React:</b><br><br>
            <span id="output-code"></span>
        </div>
    </div>

    <div id="preview-container">
        <iframe id="pdf-preview"></iframe>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        function updatePDF() {
            // 1. Obtener valores de los sliders
            const margin = parseInt(document.getElementById('margin').value);
            const leftColLabelX = parseInt(document.getElementById('leftColLabelX').value);
            const leftColValueX = parseInt(document.getElementById('leftColValueX').value);
            const rightColLabelX = parseInt(document.getElementById('rightColLabelX').value);
            const rightColValueX = parseInt(document.getElementById('rightColValueX').value);
            const tableTheme = document.getElementById('tableTheme').value;
            const lineWidth = parseFloat(document.getElementById('lineWidth').value);

            // Actualizar textos visuales
            document.getElementById('val-margin').innerText = margin;
            document.getElementById('val-leftColLabelX').innerText = leftColLabelX;
            document.getElementById('val-leftColValueX').innerText = leftColValueX;
            document.getElementById('val-rightColLabelX').innerText = rightColLabelX;
            document.getElementById('val-rightColValueX').innerText = rightColValueX;
            document.getElementById('val-lineWidth').innerText = lineWidth;

            // Actualizar código para copiar
            document.getElementById('output-code').innerText = 
`const margin = ${margin};
const leftColLabelX = ${leftColLabelX};
const leftColValueX = ${leftColValueX};
const rightColLabelX = ${rightColLabelX};
const rightColValueX = ${rightColValueX};

// En tu autoTable:
theme: '${tableTheme}',
headStyles: { ..., lineWidth: ${lineWidth} },
bodyStyles: { ..., lineWidth: ${lineWidth} },`;

            // 2. Generar el PDF
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            
            // Marco exterior
            doc.setDrawColor(0, 0, 0);
            doc.setLineWidth(0.5);
            doc.rect(margin, margin, pageWidth - (margin * 2), pageHeight - (margin * 2));

            let startY = 25;

            // Título
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("INVOICE", pageWidth / 2, startY, { align: "center" });
            startY += 15;

            // Columnas
            doc.setFontSize(9);
            const drawRow = (l1, v1, l2, v2, y) => {
                if(l1) { doc.setFont("helvetica", "bold"); doc.text(l1, leftColLabelX, y); doc.setFont("helvetica", "normal"); doc.text(v1, leftColValueX, y); }
                if(l2) { doc.setFont("helvetica", "bold"); doc.text(l2, rightColLabelX, y); doc.setFont("helvetica", "normal"); doc.text(v2, rightColValueX, y); }
            };

            // Dummy Data
            drawRow("Name", "Alejandra Ruiz", "Invoice Number", "45", startY); startY += 6;
            drawRow("Address", "2/2 Berwick St, Fortitude Valley", "Date", "02/02/2026", startY); startY += 6;
            drawRow("Telephone", "478935675", "Due Date:", "06/02/2026", startY); startY += 6;
            drawRow("ABN Number", "82640342626", "Description", "Cleaning Zara 155 Queen St", startY); startY += 6;
            drawRow("Email", "aleruizcontact@gmail.com", "", "", startY); startY += 10;
            drawRow("Company Email", "doug.s@unitedtraders.com.au", "", "", startY); startY += 6;
            drawRow("Company ABN:", "26 601 411 474", "", "", startY); startY += 6;
            drawRow("Business Telephone", "0414 270 761", "", "", startY); startY += 10;

            const blueZara = [79, 129, 189];

            // Tabla 1
            doc.autoTable({
                startY: startY,
                margin: { left: margin, right: margin },
                head: [['Description', 'Pay Period', 'Grand Total']],
                body: [['Cleaning Services Zara', '19/01/2026 - 01/02/2026', '$799.50']],
                theme: tableTheme,
                headStyles: { fillColor: blueZara, textColor: 0, fontStyle: 'bold', halign: 'center', lineColor: 0, lineWidth: lineWidth },
                bodyStyles: { textColor: 0, halign: 'center', lineColor: 0, lineWidth: lineWidth },
            });

            startY = doc.lastAutoTable.finalY + 10;
            doc.setFont("helvetica", "bold"); doc.text("Preferred Payment Methods", margin + 2, startY); startY += 6;
            doc.setFont("helvetica", "normal"); doc.text("EFT [Electronic Funds Transfer]", margin + 2, startY); startY += 10;
            
            // Tabla 2 (Banco)
            doc.autoTable({
                startY: startY,
                margin: { left: margin, right: margin },
                head: [[{ content: 'Direct Bank Transfer Details', colSpan: 4 }]],
                body: [
                    ['Bank Name', 'CommBank of Australia', 'Account Name', 'Alejandra Ruiz'],
                    ['Account Type', 'Savings', 'BSB', '064-000'],
                    ['', '', 'Account Number', '16445920']
                ],
                theme: tableTheme,
                headStyles: { fillColor: blueZara, textColor: 0, fontStyle: 'bold', halign: 'left', lineColor: 0, lineWidth: lineWidth },
                bodyStyles: { textColor: 0, halign: 'left', lineColor: 0, lineWidth: lineWidth },
                columnStyles: { 0: { fontStyle: 'bold', cellWidth: 35 }, 2: { fontStyle: 'bold', cellWidth: 35 } }
            });

            // Mostrar en iframe
            const blobUrl = doc.output('bloburl');
            document.getElementById('pdf-preview').src = blobUrl;
        }

        // Ejecutar al cargar
        window.onload = updatePDF;
    </script>
</body>
</html>